<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DC Charger Adapter Booking</title>
    <style>
        /* --- CSS STYLES --- */
        :root {
            --primary-color: #2c3e50;
            --accent-color: #3498db;
            --text-light: #ecf0f1;
            --bg-light: #f4f6f7;
            --range-bg: #d6eaf8;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Segoe UI', sans-serif; }
        
        /* Desktop Layout */
        body { height: 100vh; overflow: hidden; display: flex; }
        
        .app-container {
            display: grid;
            grid-template-columns: 250px 1fr;
            width: 100%;
            height: 100vh;
        }

        /* Sidebar */
        .sidebar {
            background-color: var(--primary-color);
            color: var(--text-light);
            padding: 20px;
            display: flex;
            flex-direction: column;
            overflow-y: auto;
        }
        .header-section h1 { font-size: 1.2rem; margin-bottom: 15px; }
        
        .lang-switch { margin-bottom: 30px; }
        .lang-switch button {
            background: none; border: 1px solid #7f8c8d; color: #bdc3c7;
            padding: 5px 10px; cursor: pointer; font-size: 0.8rem; margin-right: 5px; border-radius: 4px;
        }
        .lang-switch button.active {
            background-color: var(--accent-color); color: white; border-color: var(--accent-color);
        }
        
        .nav-links { list-style: none; padding: 0; }
        .nav-links li {
            padding: 15px 10px; cursor: pointer; border-bottom: 1px solid #34495e;
            transition: background 0.3s;
        }
        .nav-links li:hover, .nav-links li.active-link { background-color: #34495e; border-left: 4px solid var(--accent-color); }

        /* Main Content */
        .content {
            background-color: var(--bg-light);
            padding: 40px;
            overflow-y: auto;
            width: 100%;
        }
        .page-section { display: none; animation: fadeIn 0.3s; }
        .page-section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* Components */
        .card {
            background: white; padding: 25px; border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1); max-width: 100%;
        }
        .subtitle { color: #7f8c8d; margin-bottom: 15px; }
        .status-badge {
            display: inline-block; background: #27ae60; color: white;
            padding: 5px 15px; border-radius: 15px; font-size: 0.8rem; margin-top: 15px;
        }

        /* Form Styles */
        .form-group { margin-bottom: 20px; max-width: 100%; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        input, select {
            width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 4px; font-size: 16px;
        }
        .btn-submit {
            background-color: var(--accent-color); color: white; border: none;
            padding: 15px 25px; border-radius: 4px; cursor: pointer; font-size: 1rem; width: 100%;
        }
        .btn-submit:hover { background-color: #2980b9; }

        /* New Warning Message Style */
        .warning-msg {
            color: #d35400; /* Orange color */
            font-size: 0.85rem;
            margin-top: 5px;
            display: none; /* Hidden by default */
            font-style: italic;
            line-height: 1.4;
        }

        /* Calendar Styles */
        .calendar-container {
            max-width: 100%;
            margin-bottom: 20px;
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        .calendar-header {
            display: flex; justify-content: space-between; align-items: center;
            margin-bottom: 15px; font-weight: bold;
        }
        .calendar-header button {
            padding: 8px 15px; cursor: pointer; border: 1px solid #ddd; background: #fff; border-radius: 4px;
        }
        .calendar-grid {
            display: grid; grid-template-columns: repeat(7, 1fr); gap: 5px; text-align: center;
        }
        .calendar-day-name { font-size: 0.8rem; color: #7f8c8d; margin-bottom: 5px; }
        .calendar-day {
            padding: 10px 0; font-size: 0.9rem; border-radius: 4px;
            background-color: #f0f0f0; color: #bbb; pointer-events: none;
            display: flex; align-items: center; justify-content: center;
        }
        
        /* Status Colors */
        .day-available {
            background-color: #d5f5e3; color: #27ae60; cursor: pointer; pointer-events: auto; font-weight: bold;
        }
        .day-booked {
            background-color: #fadbd8; color: #c0392b; text-decoration: line-through;
        }
        
        /* Range Selection Styles */
        .day-range-start {
            background-color: var(--accent-color); color: white; border-radius: 4px 0 0 4px;
        }
        .day-range-end {
            background-color: var(--accent-color); color: white; border-radius: 0 4px 4px 0;
        }
        .day-in-range {
            background-color: var(--range-bg); color: var(--primary-color); border-radius: 0;
        }
        .day-single-select {
            background-color: var(--accent-color); color: white; border-radius: 4px;
        }

        .calendar-legend {
            display: flex; gap: 15px; font-size: 0.8rem; margin-top: 15px; flex-wrap: wrap;
        }
        .legend-item { display: flex; align-items: center; gap: 5px; }
        .dot { width: 10px; height: 10px; border-radius: 50%; }
        .dot-green { background: #27ae60; }
        .dot-red { background: #c0392b; }
        .dot-blue { background: var(--accent-color); }

        /* Mobile Fix */
        @media screen and (max-width: 768px) {
            body { flex-direction: column; height: auto; overflow-y: auto; }
            .app-container { display: flex; flex-direction: column; height: auto; }
            .sidebar { width: 100%; padding: 15px; flex-direction: row; flex-wrap: wrap; justify-content: space-between; align-items: center; }
            .header-section h1 { margin: 0; font-size: 1rem; }
            .lang-switch { margin: 0; }
            .nav-links { width: 100%; display: flex; margin-top: 15px; border-top: 1px solid #34495e; }
            .nav-links li { flex: 1; text-align: center; border-bottom: none; padding: 10px 5px; font-size: 0.9rem; }
            .nav-links li.active-link { border-left: none; border-bottom: 4px solid var(--accent-color); }
            .content { padding: 20px; overflow: visible; height: auto; }
        }
    </style>
</head>
<body>

    <div class="app-container">
        <nav class="sidebar">
            <div class="header-section">
                <h1 id="nav-title">Adapter Booking</h1>
                <div class="lang-switch">
                    <button id="btn-tc" onclick="setLanguage('tc')" class="active">中文</button>
                    <button id="btn-en" onclick="setLanguage('en')">EN</button>
                </div>
            </div>
            <ul class="nav-links">
                <li onclick="showPage('home')" class="active-link" id="link-home">Home</li>
                <li onclick="showPage('booking')" id="link-booking">Booking</li>
                <li onclick="showPage('contact')" id="link-contact">Contact</li>
            </ul>
        </nav>

        <main class="content">
            <section id="home" class="page-section active">
                <h2 id="home-title">Welcome</h2>
                <div class="card">
                    <h3 id="product-name">Honnmono DC Adapter (Not Pro)</h3>
                    <p class="subtitle">GB/T to CCS2</p>
                    <hr style="margin: 10px 0; border: 0; border-top: 1px solid #eee;">
                    <p id="product-desc">
                        This adapter allows you to convert GB/T standard charging piles to CCS2 standard. 
                        Safe, reliable, and easy to use.
                    </p>
                    <div class="status-badge" id="status-avail">Available for Rent</div>
                </div>
            </section>

            <section id="booking" class="page-section">
                <h2 id="booking-title">Book Schedule</h2>
                <p id="booking-desc" style="margin-bottom:15px;">Check the calendar below for availability. Select Start Date and End Date.</p>

                <div class="calendar-container">
                    <div class="calendar-header">
                        <button onclick="changeMonth(-1)">&lt;</button>
                        <span id="calendar-month-year">Month Year</span>
                        <button onclick="changeMonth(1)">&gt;</button>
                    </div>
                    <div class="calendar-grid" id="calendar-grid"></div>
                    <div class="calendar-legend">
                        <div class="legend-item"><span class="dot dot-green"></span> <span id="leg-avail">Available</span></div>
                        <div class="legend-item"><span class="dot dot-red"></span> <span id="leg-booked">Booked</span></div>
                        <div class="legend-item"><span class="dot dot-blue"></span> <span id="leg-selected">Your Selection</span></div>
                    </div>
                </div>
                
                <form id="bookingForm" onsubmit="handleBooking(event)">
                    <div class="form-group">
                        <label id="lbl-name">Name:</label>
                        <input type="text" id="name" required>
                    </div>

                    <div class="form-group">
                        <label id="lbl-period">Booking Period:</label>
                        <input type="text" id="booking-period" required readonly placeholder="Select range on calendar">
                    </div>

                    <div class="form-group">
                        <label id="lbl-delivery-date">Delivery Date:</label>
                        <input type="date" id="delivery-date" required onchange="checkDeliveryDate()">
                        <small id="weekend-msg" class="warning-msg"></small>
                    </div>

                    <div class="form-group">
                        <label id="lbl-time">Time (Night):</label>
                        <select id="time">
                            <option value="18:00">18:00</option>
                            <option value="19:00">19:00</option>
                            <option value="20:00">20:00</option>
                            <option value="21:00">21:00</option>
                            <option value="22:00">22:00</option>
                        </select>
                    </div>

                    <button type="submit" class="btn-submit" id="btn-submit" disabled style="opacity: 0.5;">Request Booking</button>
                </form>
            </section>

            <section id="contact" class="page-section">
                <h2 id="contact-title">Contact Us</h2>
                <div class="contact-info">
                    <p><strong>Phone:</strong> +852 1234 5678</p>
                    <p><strong>Email:</strong> jerry@example.com</p>
                </div>
            </section>
        </main>
    </div>

    <script>
        // *** CONFIGURATION: GOOGLE SHEET LINK ***
        const SHEET_CSV_URL = 'PASTE_YOUR_GOOGLE_SHEET_LINK_HERE'; 

        // State Variables
        let bookedDates = [];
        let selectionStart = null;
        let selectionEnd = null;
        
        const translations = {
            en: {
                navTitle: "Adapter Booking", linkHome: "Home", linkBooking: "Booking", linkContact: "Contact",
                homeTitle: "Welcome", productName: "Honnmono DC Adapter (Not Pro)",
                productDesc: "This adapter allows you to convert GB/T standard charging piles to CCS2 standard. Safe, reliable, and easy to use.",
                statusAvail: "Available for Rent", bookingTitle: "Book Schedule",
                bookingDesc: "Select your Start Date and End Date on the calendar.",
                lblName: "Name:", 
                lblPeriod: "Booking Period:", 
                lblDeliveryDate: "Delivery Date:",
                lblTime: "Time (Night):",
                btnSubmit: "Request Booking via Email", contactTitle: "Contact Us",
                legendAvail: "Available", legendBooked: "Booked", legendSelected: "Selection",
                weekendMsg: "Hope you well in your holiday, delivery in weekend harms our family times. However let's go into detail after your confirmation. Thanks!"
            },
            tc: {
                navTitle: "充電轉接器預約", linkHome: "主頁", linkBooking: "預約", linkContact: "聯絡我們",
                homeTitle: "歡迎", productName: "Honnmono 直流轉接器 (非 Pro 版)",
                productDesc: "此轉接器可將 GB/T 標準充電樁轉換為 CCS2 標準。安全、可靠、易用。",
                statusAvail: "可供租用", bookingTitle: "預約時間表",
                bookingDesc: "請在日曆上選擇開始日期和結束日期。",
                lblName: "姓名:", 
                lblPeriod: "租用期 (日曆選擇):", 
                lblDeliveryDate: "交收日期:",
                lblTime: "交收時間 (晚間):",
                btnSubmit: "通過電子郵件發送預約", contactTitle: "聯絡資料",
                legendAvail: "可預約", legendBooked: "已預約", legendSelected: "您的選擇",
                weekendMsg: "祝您假期愉快，週末交收難免影響家庭時間。不過讓我們在確認訂單後再詳談細節。謝謝！"
            }
        };

        let currentLang = 'tc';
        let currentYear = new Date().getFullYear();
        let currentMonth = new Date().getMonth();

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            setLanguage('tc');
            renderCalendar(currentMonth, currentYear);
            fetchBookings(); 
        });

        async function fetchBookings() {
            if (SHEET_CSV_URL.includes('PASTE_YOUR')) return; 
            try {
                const cacheBuster = '&t=' + new Date().getTime();
                const response = await fetch(SHEET_CSV_URL + cacheBuster);
                if (response.ok) {
                    const csvText = await response.text();
                    bookedDates = csvText.split('\n').map(row => row.trim()).filter(row => row.length > 0);
                }
            } catch (error) { console.log("Error loading sheet"); }
            renderCalendar(currentMonth, currentYear);
        }

        function renderCalendar(month, year) {
            const grid = document.getElementById('calendar-grid');
            const monthTitle = document.getElementById('calendar-month-year');
            const monthNames = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
            
            monthTitle.innerText = `${monthNames[month]} ${year}`;
            grid.innerHTML = "";

            ["S", "M", "T", "W", "T", "F", "S"].forEach(d => {
                const div = document.createElement('div');
                div.className = 'calendar-day-name';
                div.innerText = d;
                grid.appendChild(div);
            });

            const firstDay = new Date(year, month, 1).getDay();
            const daysInMonth = new Date(year, month + 1, 0).getDate();

            for (let i = 0; i < firstDay; i++) { grid.appendChild(document.createElement('div')); }

            for (let day = 1; day <= daysInMonth; day++) {
                const div = document.createElement('div');
                div.className = 'calendar-day';
                div.innerText = day;
                const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                
                const dateObj = new Date(year, month, day);
                const isBooked = bookedDates.some(bd => bd.includes(dateStr));
                
                const today = new Date(); today.setHours(0,0,0,0);
                const isPast = dateObj < today; 

                // --- LOGIC UPDATE: Removed !isWeekend check here ---
                // Now weekends are clickable if they are not booked.
                
                if (isBooked) {
                    div.classList.add('day-booked');
                } 
                else if (isInSelection(dateStr)) {
                    styleSelection(div, dateStr);
                    div.onclick = () => handleDateClick(dateStr); 
                }
                else if (!isPast) { // Weekends allowed now!
                    div.classList.add('day-available');
                    div.onclick = () => handleDateClick(dateStr);
                }

                grid.appendChild(div);
            }
        }

        // --- DELIVERY DATE CHECK ---
        function checkDeliveryDate() {
            const input = document.getElementById('delivery-date');
            const msg = document.getElementById('weekend-msg');
            
            if(!input.value) {
                msg.style.display = 'none';
                return;
            }

            const date = new Date(input.value);
            const day = date.getDay(); // 0 = Sun, 6 = Sat

            if (day === 0 || day === 6) {
                msg.innerText = translations[currentLang].weekendMsg;
                msg.style.display = 'block';
            } else {
                msg.style.display = 'none';
            }
        }

        // --- NEW SELECTION LOGIC ---
        function handleDateClick(dateStr) {
            if (selectionStart && selectionEnd) {
                selectionStart = dateStr;
                selectionEnd = null;
            }
            else if (!selectionStart) {
                selectionStart = dateStr;
            }
            else {
                if (dateStr < selectionStart) {
                    selectionEnd = selectionStart;
                    selectionStart = dateStr;
                } else {
                    selectionEnd = dateStr;
                }

                if (!validateRange(selectionStart, selectionEnd)) {
                    alert(currentLang === 'tc' ? "選擇的範圍內包含已被預約的日期，請重新選擇。" : "Selection includes already booked dates.");
                    selectionStart = dateStr;
                    selectionEnd = null;
                }
            }

            updateForm();
            renderCalendar(currentMonth, currentYear);
        }

        function validateRange(start, end) {
            let curr = new Date(start);
            const last = new Date(end);
            while (curr <= last) {
                const dStr = curr.toISOString().split('T')[0];
                if (bookedDates.some(bd => bd.includes(dStr))) return false;
                curr.setDate(curr.getDate() + 1);
            }
            return true;
        }

        function isInSelection(dateStr) {
            if (!selectionStart) return false;
            if (dateStr === selectionStart) return true;
            if (selectionEnd && dateStr === selectionEnd) return true;
            if (selectionStart && selectionEnd && dateStr > selectionStart && dateStr < selectionEnd) return true;
            return false;
        }

        function styleSelection(div, dateStr) {
            div.classList.remove('day-available');
            if (dateStr === selectionStart && dateStr === selectionEnd) {
                div.classList.add('day-single-select');
            } else if (dateStr === selectionStart) {
                div.classList.add('day-range-start');
            } else if (dateStr === selectionEnd) {
                div.classList.add('day-range-end');
            } else {
                div.classList.add('day-in-range');
            }
        }

        function updateForm() {
            const input = document.getElementById('booking-period');
            const btn = document.getElementById('btn-submit');
            
            if (selectionStart && selectionEnd) {
                input.value = `${selectionStart} to ${selectionEnd}`;
                btn.disabled = false;
                btn.style.opacity = "1";
            } else if (selectionStart) {
                input.value = `${selectionStart} (Select End Date)`;
                btn.disabled = true;
                btn.style.opacity = "0.5";
            } else {
                input.value = "";
                btn.disabled = true;
                btn.style.opacity = "0.5";
            }
        }

        function changeMonth(step) {
            currentMonth += step;
            if (currentMonth < 0) { currentMonth = 11; currentYear--; } 
            else if (currentMonth > 11) { currentMonth = 0; currentYear++; }
            renderCalendar(currentMonth, currentYear);
        }

        function setLanguage(lang) {
            currentLang = lang;
            const t = translations[lang];
            const ids = ['nav-title','link-home','link-booking','link-contact','home-title',
                         'product-name','product-desc','status-avail','booking-title','booking-desc',
                         'lbl-name','lbl-period','lbl-delivery-date','lbl-time','btn-submit','contact-title'];
            
            ids.forEach(id => {
                const el = document.getElementById(id);
                if(el) {
                    const key = id.replace(/-([a-z])/g, (g) => g[1].toUpperCase());
                    if(t[key]) el.innerText = t[key];
                }
            });

            document.getElementById('leg-avail').innerText = t.legendAvail;
            document.getElementById('leg-booked').innerText = t.legendBooked;
            document.getElementById('leg-selected').innerText = t.legendSelected;

            document.querySelectorAll('.lang-switch button').forEach(btn => btn.classList.remove('active'));
            if(lang === 'tc') document.getElementById('btn-tc').classList.add('active');
            if(lang === 'en') document.getElementById('btn-en').classList.add('active');

            // Re-check delivery date msg in case language changed while msg is showing
            checkDeliveryDate();
        }

        function showPage(pageId) {
            document.querySelectorAll('.page-section').forEach(section => section.classList.remove('active'));
            document.getElementById(pageId).classList.add('active');
            document.querySelectorAll('.nav-links li').forEach(li => li.classList.remove('active-link'));
            document.getElementById('link-' + pageId).classList.add('active-link');
        }

        function handleBooking(e) {
            e.preventDefault();
            const name = document.getElementById('name').value;
            const period = document.getElementById('booking-period').value;
            const deliveryDate = document.getElementById('delivery-date').value;
            const time = document.getElementById('time').value;

            const subject = `Booking Request: Honnmono Adapter`;
            const body = `Hi,\n\nI would like to book the adapter.\n\nName: ${name}\nBooking Period: ${period}\n\nDelivery Date: ${deliveryDate}\nTime: ${time}\n\nPlease confirm.`;
            
            window.location.href = `mailto:jerry@example.com?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
        }
    </script>
</body>
</html>