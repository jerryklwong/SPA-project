<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DC Charger Adapter Booking</title>
    <style>
        /* --- CSS STYLES --- */
        :root {
            --primary-color: #2c3e50;
            --accent-color: #3498db;
            --text-light: #ecf0f1;
            --bg-light: #f4f6f7;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Segoe UI', sans-serif; }
        
        /* Desktop Layout (Default) */
        body { height: 100vh; overflow: hidden; display: flex; }
        
        .app-container {
            display: grid;
            grid-template-columns: 250px 1fr;
            width: 100%;
            height: 100vh;
        }

        /* Sidebar Styles */
        .sidebar {
            background-color: var(--primary-color);
            color: var(--text-light);
            padding: 20px;
            display: flex;
            flex-direction: column;
            overflow-y: auto;
        }
        .header-section h1 { font-size: 1.2rem; margin-bottom: 15px; }
        
        .lang-switch { margin-bottom: 30px; }
        .lang-switch button {
            background: none; border: 1px solid #7f8c8d; color: #bdc3c7;
            padding: 5px 10px; cursor: pointer; font-size: 0.8rem; margin-right: 5px; border-radius: 4px;
        }
        .lang-switch button.active {
            background-color: var(--accent-color); color: white; border-color: var(--accent-color);
        }
        
        .nav-links { list-style: none; padding: 0; }
        .nav-links li {
            padding: 15px 10px; cursor: pointer; border-bottom: 1px solid #34495e;
            transition: background 0.3s;
        }
        .nav-links li:hover, .nav-links li.active-link { background-color: #34495e; border-left: 4px solid var(--accent-color); }

        /* Main Content Styles */
        .content {
            background-color: var(--bg-light);
            padding: 40px;
            overflow-y: auto;
            width: 100%;
        }
        .page-section { display: none; animation: fadeIn 0.3s; }
        .page-section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* Components */
        .card {
            background: white; padding: 25px; border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1); max-width: 100%;
        }
        .subtitle { color: #7f8c8d; margin-bottom: 15px; }
        .status-badge {
            display: inline-block; background: #27ae60; color: white;
            padding: 5px 15px; border-radius: 15px; font-size: 0.8rem; margin-top: 15px;
        }

        /* Form Styles */
        .form-group { margin-bottom: 20px; max-width: 100%; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        input, select {
            width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 4px; font-size: 16px; /* 16px prevents zoom on iOS */
        }
        .btn-submit {
            background-color: var(--accent-color); color: white; border: none;
            padding: 15px 25px; border-radius: 4px; cursor: pointer; font-size: 1rem; width: 100%;
        }
        .btn-submit:hover { background-color: #2980b9; }

        /* Calendar Styles */
        .calendar-container {
            max-width: 100%;
            margin-bottom: 20px;
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        .calendar-header {
            display: flex; justify-content: space-between; align-items: center;
            margin-bottom: 15px; font-weight: bold;
        }
        .calendar-header button {
            padding: 8px 15px; cursor: pointer; border: 1px solid #ddd; background: #fff; border-radius: 4px;
        }
        .calendar-grid {
            display: grid; grid-template-columns: repeat(7, 1fr); gap: 5px; text-align: center;
        }
        .calendar-day-name { font-size: 0.8rem; color: #7f8c8d; margin-bottom: 5px; }
        .calendar-day {
            padding: 10px 0; font-size: 0.9rem; border-radius: 4px;
            background-color: #f0f0f0; color: #bbb; pointer-events: none;
            display: flex; align-items: center; justify-content: center;
        }
        .day-available {
            background-color: #d5f5e3; color: #27ae60; cursor: pointer; pointer-events: auto; font-weight: bold;
        }
        .day-booked {
            background-color: #fadbd8; color: #c0392b; text-decoration: line-through;
        }
        .day-selected { border: 2px solid var(--accent-color); }
        .calendar-legend {
            display: flex; gap: 15px; font-size: 0.8rem; margin-top: 15px; flex-wrap: wrap;
        }
        .legend-item { display: flex; align-items: center; gap: 5px; }
        .dot { width: 10px; height: 10px; border-radius: 50%; }
        .dot-green { background: #27ae60; }
        .dot-red { background: #c0392b; }

        /* --- MOBILE RESPONSIVE FIX --- */
        @media screen and (max-width: 768px) {
            body { 
                flex-direction: column; 
                height: auto; 
                overflow-y: auto; /* Enable scrolling on body */
            }
            .app-container {
                display: flex;
                flex-direction: column;
                height: auto;
            }
            .sidebar {
                width: 100%;
                padding: 15px;
                flex-direction: row;
                flex-wrap: wrap;
                justify-content: space-between;
                align-items: center;
            }
            .header-section h1 { margin: 0; font-size: 1rem; }
            .lang-switch { margin: 0; }
            .nav-links {
                width: 100%;
                display: flex;
                margin-top: 15px;
                border-top: 1px solid #34495e;
            }
            .nav-links li {
                flex: 1;
                text-align: center;
                border-bottom: none;
                padding: 10px 5px;
                font-size: 0.9rem;
            }
            .nav-links li.active-link {
                border-left: none;
                border-bottom: 4px solid var(--accent-color);
            }
            .content {
                padding: 20px;
                overflow: visible; /* Let the page grow */
                height: auto;
            }
        }
    </style>
</head>
<body>

    <div class="app-container">
        <nav class="sidebar">
            <div class="header-section">
                <h1 id="nav-title">Adapter Booking</h1>
                <div class="lang-switch">
                    <button id="btn-tc" onclick="setLanguage('tc')" class="active">中文</button>
                    <button id="btn-en" onclick="setLanguage('en')">EN</button>
                </div>
            </div>
            <ul class="nav-links">
                <li onclick="showPage('home')" class="active-link" id="link-home">Home</li>
                <li onclick="showPage('booking')" id="link-booking">Booking</li>
                <li onclick="showPage('contact')" id="link-contact">Contact</li>
            </ul>
        </nav>

        <main class="content">
            <section id="home" class="page-section active">
                <h2 id="home-title">Welcome</h2>
                <div class="card">
                    <h3 id="product-name">Honnmono DC Adapter (Not Pro)</h3>
                    <p class="subtitle">GB/T to CCS2</p>
                    <hr style="margin: 10px 0; border: 0; border-top: 1px solid #eee;">
                    <p id="product-desc">
                        This adapter allows you to convert GB/T standard charging piles to CCS2 standard. 
                        Safe, reliable, and easy to use.
                    </p>
                    <div class="status-badge" id="status-avail">Available for Rent</div>
                </div>
            </section>

            <section id="booking" class="page-section">
                <h2 id="booking-title">Book Schedule</h2>
                <p id="booking-desc" style="margin-bottom:15px;">Check the calendar below for availability. Red dates are already booked.</p>

                <div class="calendar-container">
                    <div class="calendar-header">
                        <button onclick="changeMonth(-1)">&lt;</button>
                        <span id="calendar-month-year">Month Year</span>
                        <button onclick="changeMonth(1)">&gt;</button>
                    </div>
                    <div class="calendar-grid" id="calendar-grid"></div>
                    <div class="calendar-legend">
                        <div class="legend-item"><span class="dot dot-green"></span> <span id="leg-avail">Available</span></div>
                        <div class="legend-item"><span class="dot dot-red"></span> <span id="leg-booked">Booked</span></div>
                    </div>
                </div>
                
                <form id="bookingForm" onsubmit="handleBooking(event)">
                    <div class="form-group">
                        <label id="lbl-name">Name:</label>
                        <input type="text" id="name" required>
                    </div>

                    <div class="form-group">
                        <label id="lbl-date">Selected Date:</label>
                        <input type="text" id="date" required readonly placeholder="Select a green date above">
                    </div>

                    <div class="form-group">
                        <label id="lbl-time">Time (Night):</label>
                        <select id="time">
                            <option value="18:00">18:00</option>
                            <option value="19:00">19:00</option>
                            <option value="20:00">20:00</option>
                            <option value="21:00">21:00</option>
                            <option value="22:00">22:00</option>
                        </select>
                    </div>

                    <button type="submit" class="btn-submit" id="btn-submit" disabled style="opacity: 0.5;">Request Booking</button>
                </form>
            </section>

            <section id="contact" class="page-section">
                <h2 id="contact-title">Contact Us</h2>
                <div class="contact-info">
                    <p><strong>Phone:</strong> +852 1234 5678</p>
                    <p><strong>Email:</strong> jerry@example.com</p>
                </div>
            </section>
        </main>
    </div>

    <script>
        // *** CONFIGURATION: DEFAULT LIST (Fallback) ***
        let bookedDates = [
            "2026-01-01", 
            "2026-01-02", 
            "2026-01-15"
        ];
        
        // Use external file
        const GITHUB_JSON_URL = './bookings.json'; 

        const translations = {
            en: {
                navTitle: "Adapter Booking", linkHome: "Home", linkBooking: "Booking", linkContact: "Contact",
                homeTitle: "Welcome", productName: "Honnmono DC Adapter (Not Pro)",
                productDesc: "This adapter allows you to convert GB/T standard charging piles to CCS2 standard. Safe, reliable, and easy to use.",
                statusAvail: "Available for Rent", bookingTitle: "Book Schedule",
                bookingDesc: "Check the calendar below for availability. Red dates are already booked.",
                lblName: "Name:", lblDate: "Selected Date:", lblTime: "Time (Night):",
                btnSubmit: "Request Booking via Email", contactTitle: "Contact Us",
                legendAvail: "Available", legendBooked: "Booked"
            },
            tc: {
                navTitle: "充電轉接器預約", linkHome: "主頁", linkBooking: "預約", linkContact: "聯絡我們",
                homeTitle: "歡迎", productName: "Honnmono 直流轉接器 (非 Pro 版)",
                productDesc: "此轉接器可將 GB/T 標準充電樁轉換為 CCS2 標準。安全、可靠、易用。",
                statusAvail: "可供租用", bookingTitle: "預約時間表",
                bookingDesc: "請查看下方日曆。紅色日期已被預約。",
                lblName: "姓名:", lblDate: "已選日期:", lblTime: "時間 (晚間):",
                btnSubmit: "通過電子郵件發送預約", contactTitle: "聯絡資料",
                legendAvail: "可預約", legendBooked: "已預約"
            }
        };

        let currentLang = 'tc';
        let currentYear = new Date().getFullYear();
        let currentMonth = new Date().getMonth();

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            setLanguage('tc');
            
            // Render Calendar IMMEDIATELY
            renderCalendar(currentMonth, currentYear);

            // THEN fetch data to update the red dots
            fetchBookings(); 
        });

        async function fetchBookings() {
            try {
                // Add a random number to avoid cache
                const cacheBuster = '?t=' + new Date().getTime();
                const response = await fetch(GITHUB_JSON_URL + cacheBuster);
                
                if (response.ok) {
                    bookedDates = await response.json();
                }
            } catch (error) {
                console.log("Could not load external file, using fallback list.");
            }
            // Re-render
            renderCalendar(currentMonth, currentYear);
        }

        function renderCalendar(month, year) {
            const grid = document.getElementById('calendar-grid');
            const monthTitle = document.getElementById('calendar-month-year');
            const monthNames = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
            
            monthTitle.innerText = `${monthNames[month]} ${year}`;
            grid.innerHTML = "";

            // Days Header
            ["S", "M", "T", "W", "T", "F", "S"].forEach(d => {
                const div = document.createElement('div');
                div.className = 'calendar-day-name';
                div.innerText = d;
                grid.appendChild(div);
            });

            const firstDay = new Date(year, month, 1).getDay();
            const daysInMonth = new Date(year, month + 1, 0).getDate();

            for (let i = 0; i < firstDay; i++) {
                grid.appendChild(document.createElement('div'));
            }

            for (let day = 1; day <= daysInMonth; day++) {
                const div = document.createElement('div');
                div.className = 'calendar-day';
                div.innerText = day;
                const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                
                const dateObj = new Date(year, month, day);
                const dayOfWeek = dateObj.getDay();
                const isWeekend = (dayOfWeek === 0 || dayOfWeek === 6);
                const isBooked = bookedDates.includes(dateStr);
                
                const today = new Date();
                today.setHours(0,0,0,0);
                const isPast = dateObj < today; 

                if (isBooked) {
                    div.classList.add('day-booked');
                } else if (!isWeekend && !isPast) {
                    div.classList.add('day-available');
                    div.onclick = () => selectDate(dateStr, div);
                }
                grid.appendChild(div);
            }
        }

        function changeMonth(step) {
            currentMonth += step;
            if (currentMonth < 0) { currentMonth = 11; currentYear--; } 
            else if (currentMonth > 11) { currentMonth = 0; currentYear++; }
            renderCalendar(currentMonth, currentYear);
        }

        function selectDate(dateStr, element) {
            document.querySelectorAll('.day-available').forEach(el => el.classList.remove('day-selected'));
            element.classList.add('day-selected');
            document.getElementById('date').value = dateStr;
            const btn = document.getElementById('btn-submit');
            btn.disabled = false;
            btn.style.opacity = "1";
        }

        function setLanguage(lang) {
            currentLang = lang;
            const t = translations[lang];
            const ids = ['nav-title','link-home','link-booking','link-contact','home-title',
                         'product-name','product-desc','status-avail','booking-title','booking-desc',
                         'lbl-name','lbl-date','lbl-time','btn-submit','contact-title'];
            
            ids.forEach(id => {
                const el = document.getElementById(id);
                if(el) {
                    const key = id.replace(/-([a-z])/g, (g) => g[1].toUpperCase());
                    if(t[key]) el.innerText = t[key];
                }
            });

            document.getElementById('leg-avail').innerText = t.legendAvail;
            document.getElementById('leg-booked').innerText = t.legendBooked;

            // *** FIXED LOGIC: Toggle button without relying on 'event' ***
            document.querySelectorAll('.lang-switch button').forEach(btn => btn.classList.remove('active'));
            if(lang === 'tc') document.getElementById('btn-tc').classList.add('active');
            if(lang === 'en') document.getElementById('btn-en').classList.add('active');
        }

        function showPage(pageId) {
            document.querySelectorAll('.page-section').forEach(section => section.classList.remove('active'));
            document.getElementById(pageId).classList.add('active');
            document.querySelectorAll('.nav-links li').forEach(li => li.classList.remove('active-link'));
            document.getElementById('link-' + pageId).classList.add('active-link');
        }

        function handleBooking(e) {
            e.preventDefault();
            const name = document.getElementById('name').value;
            const date = document.getElementById('date').value;
            const time = document.getElementById('time').value;
            const subject = `Booking Request: Honnmono Adapter - ${date}`;
            const body = `Hi,\n\nI would like to book the adapter.\n\nName: ${name}\nDelivery Date: ${date}\nTime: ${time}\n\nPlease confirm.`;
            window.location.href = `mailto:jerryklwong@gmail.com?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
        }
    </script>
</body>
</html>
